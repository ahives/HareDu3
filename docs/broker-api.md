# Broker API

The Broker API is the lowest level API because it interacts directly with the RabbitMQ broker. With this API you can administer the broker and perform the below operations on each broker object:

| Broker Object | Operations                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Binding** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/binding-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/binding-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/binding-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Channel** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/channel-get.md), [GetByConnection](https://github.com/ahives/HareDu3/blob/master/docs/channel-get-by-connection.md), [GetByVirtualHost](https://github.com/ahives/HareDu3/blob/master/docs/channel-get-by-virtual-host.md), [GetByVirtualHost](https://github.com/ahives/HareDu3/blob/master/docs/channel-get-by-name.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Connection** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/connection-get-all.md), [GetByVirtualHost](https://github.com/ahives/HareDu3/blob/master/docs/connection-get-vhost.md), [GetByName](https://github.com/ahives/HareDu3/blob/master/docs/connection-get-name.md), [GetByUser](https://github.com/ahives/HareDu3/blob/master/docs/connection-get-user.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/connection-delete.md), [DeleteByUser](https://github.com/ahives/HareDu3/blob/master/docs/connection-delete-user.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Consumer** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/consumer-get.md), [GetByVirtualHost](https://github.com/ahives/HareDu3/blob/master/docs/consumer-get-by-vhost.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **Exchange** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/exchange-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/exchange-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/exchange-delete.md), [BindToExchange](https://github.com/ahives/HareDu3/blob/master/docs/exchange-bind.md), [Unbind](https://github.com/ahives/HareDu3/blob/master/docs/exchange-unbind.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Queue** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/queue-get-all.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/queue-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/queue-delete.md), [Empty](https://github.com/ahives/HareDu3/blob/master/docs/queue-empty.md), [Sync](https://github.com/ahives/HareDu3/blob/master/docs/queue-sync.md), [CancelSync](https://github.com/ahives/HareDu3/blob/master/docs/queue-sync-cancel.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Broker** | [GetOverview](https://github.com/ahives/HareDu3/blob/master/docs/broker-overview-get.md), [RebalanceAllQueues](https://github.com/ahives/HareDu3/blob/master/docs/broker-rebalance-queues.md), [IsAlarmsInEffect](https://github.com/ahives/HareDu3/blob/master/docs/broker-alarms-in-effect-check.md), [IsVirtualHostsRunning](https://github.com/ahives/HareDu3/blob/master/docs/broker-vhost-running-check.md), [IsBrokerAlive](https://github.com/ahives/HareDu3/blob/master/docs/broker-alive-check.md), [IsNodeMirrorSyncCritical](https://github.com/ahives/HareDu3/blob/master/docs/broker-node-mirror-sync-check.md), [IsNodeQuorumCritical](https://github.com/ahives/HareDu3/blob/master/docs/broker-node-quorum-check.md), [IsProtocolActiveListener](https://github.com/ahives/HareDu3/blob/master/docs/protocol-active-listener-check.md)                                                                                                                                                                   |
| **VirtualHost** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/vhost-get-all.md), [Get](https://github.com/ahives/HareDu3/blob/master/docs/vhost-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/vhost-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/vhost-delete.md), [Startup](https://github.com/ahives/HareDu3/blob/master/docs/vhost-startup.md), [GetAllLimits](https://github.com/ahives/HareDu3/blob/master/docs/vhost-limits-get-all.md), [DefineLimit](https://github.com/ahives/HareDu3/blob/master/docs/vhost-limit-define.md), [GetAllPermissions](https://github.com/ahives/HareDu3/blob/master/docs/vhost-permissions-get-all.md), [GetTopicPermissions](https://github.com/ahives/HareDu3/blob/master/docs/vhost-get-topic-permissions.md), [ApplyPermissions](https://github.com/ahives/HareDu3/blob/master/docs/vhost-user-permissions-create.md), [DeletePermissions](https://github.com/ahives/HareDu3/blob/master/docs/vhost-user-permissions-delete.md) |
| **GlobalParameter** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/global-parameter-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/global-parameter-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/global-parameter-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **Server** | [Get](https://github.com/ahives/HareDu3/blob/master/docs/server-get.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| **Node** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/node-get-all.md), [GetMemoryUsage](https://github.com/ahives/HareDu3/blob/master/docs/node-memory-get.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **ScopedParameter** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/scoped-parameter-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/scoped-parameter-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/scoped-parameter-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| **TopicPermissions** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/topic-permissions-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/topic-permissions-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/topic-permissions-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| **User** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/user-get.md), [GetAllWithoutPermissions](https://github.com/ahives/HareDu3/blob/master/docs/user-get-without-permissions.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/user-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/user-delete.md), [BulkDelete](https://github.com/ahives/HareDu3/blob/master/docs/user-bulk-delete.md), [GetAllPermissions](https://github.com/ahives/HareDu3/blob/master/docs/user-permissions-get.md), [GetUserLimits](https://github.com/ahives/HareDu3/blob/master/docs/user-get-limits.md), [DeletePermissions](https://github.com/ahives/HareDu3/blob/master/docs/user-permissions-delete.md), [DeleteLimit](https://github.com/ahives/HareDu3/blob/master/docs/user-limit-delete.md), [DeleteLimit](https://github.com/ahives/HareDu3/blob/master/docs/user-limit-delete.md)                                                                                                     |
| **Policy** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/policy-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/policy-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/policy-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| **OperatorPolicy** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/operator-policy-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/operator-policy-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/operator-policy-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| **Shovel** | [GetAll](https://github.com/ahives/HareDu3/blob/master/docs/shovel-get.md), [Create](https://github.com/ahives/HareDu3/blob/master/docs/shovel-create.md), [Delete](https://github.com/ahives/HareDu3/blob/master/docs/shovel-delete.md)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |

### Registering API Objects
The very first thing you need to do is register/initialize the appropriate objects you will need to perform operations on the RabbitMQ broker. To do that you have two options, that is, initialize the objects yourself, managing the associated lifetime scopes of said objects or use one of the supported DI containers. Currently, HareDu 4 supports only DI container; Microsoft, respectively.

### Performing Broker Operations
The Broker API is considered the lowest level API because it allows you to administer RabbitMQ (e.g., users, queues, exchanges, etc.).

```c#
var result = await _services.GetService<IBrokerFactory>()
    .API<Binding>(x => x.UsingCredentials("guest", "guest"))
    .GetAll();
```

*Note: if you have one of the above DI usage scenarios, then you can combine steps 1 and 2 because ```IBrokerFactory``` is registered using the Singleton pattern and the ```API``` method uses memoization and therefore will not take a performance hit for subsequent calls to the same object.*

<br>

*ex: Create a durable queue called *test-queue* on a vhost called *test-vhost* on node *rabbit@localhost* that has a per-message time to live (x-message-ttl) value of 2 seconds*

Here is the code...

```c#
var result = await services.GetService<IBrokerFactory>()
    .API<Queue>(x => x.UsingCredentials("guest", "guest"))
    .Create("test-queue", "test-vhost", "rabbit@localhost", x =>
    {
        x.IsDurable();
        x.HasArguments(arg =>
        {
            arg.SetPerQueuedMessageExpiration(2000);
        });
    });
```

Since HareDu 4 introduces extension methods for ```IBrokerFactory```, you could rewrite the above code example like so...

```c#
var result = await services.GetService<IBrokerFactory>()
    .CreateQueue(x => x.UsingCredentials("guest", "guest"), "test-queue", "test-vhost", "rabbit@localhost", x =>
    {
        x.IsDurable();
        x.HasArguments(arg =>
        {
            arg.SetPerQueuedMessageExpiration(2000);
        });
    });
```
